# EE Intake - GitHub Pages Site

This is the public GitHub Pages site for the EE Intake project artifacts.

**Live Site:** https://rc979.github.io/EEIntake-Pages/

## Overview

This `exports/github-pages/` folder contains the complete GitHub Pages site export. It is generated by `scripts/publish/publish_pages_site.py` and pushed directly to the `EEIntake-Pages` repository using git subtree.

**Important:** This folder is pushed directly to GitHub Pages - there is no intermediate staging folder. All URLs are updated in-place before pushing.

**Note:** This is a GitHub Pages export, which is why it's located under `exports/` alongside other exports (PDF, DOCX).

## Deployment Instructions

### Initial Setup (One-time)

1. **Enable GitHub Pages:**
   - Go to: https://github.com/rc979/EEIntake-Pages/settings/pages
   - Source: **Deploy from a branch**
   - Branch: `main`
   - Folder: `/ (root)`
   - Click **Save**

2. **Wait for build:**
   - GitHub Pages will automatically build and deploy
   - Site will be live at: https://rc979.github.io/EEIntake-Pages/

### Updating the Site

**Recommended Method - Git Subtree Push (Fast & Simple):**

From the main EEIntake repo directory:

```bash
# 1. Generate/update exports/github-pages/ folder (if needed)
#    This copies phase artifacts, extracts galleries, generates HTML viewers, etc.
python3 scripts/publish/publish_pages_site.py

# 2. Update links to GitHub Pages URLs (replaces any old Netlify URLs)
#    This updates URLs in-place in the exports/github-pages/ folder
./scripts/publish/prepare_gh_pages.sh EEIntake-Pages rc979

# 3. Commit the exports/github-pages/ folder to main repo
git add exports/github-pages/
git commit -m "Update Pages site files"
git push

# 4. Push to Pages repo using git subtree (single fast operation!)
#    Note: We split the commands to avoid DNS resolution issues
SPLIT_SHA=$(git subtree split --prefix=exports/github-pages 2>/dev/null)
sleep 1
git push pages-repo $SPLIT_SHA:main --force
```

**Why this is recommended:**
- ✅ Uses regular git push (no API calls)
- ✅ Single operation (not 170+ API calls)
- ✅ Fast (~5-10 seconds)
- ✅ Works reliably (verified method)
- ✅ No intermediate staging folder needed

**Alternative Method - Using the Push Script:**

The push script automates steps 2-4:

```bash
# This does steps 2-4 automatically
./scripts/publish/push_to_gh_pages.sh EEIntake-Pages rc979
```

**Alternative Method - GitHub Actions Workflow:**

If you prefer automated syncing:

```bash
# 1. Prepare and commit exports/github-pages/
./scripts/publish/prepare_gh_pages.sh EEIntake-Pages rc979
git add exports/github-pages/
git commit -m "Update Pages site files"
git push

# 2. Trigger the sync workflow
gh workflow run sync-from-main.yml --repo rc979/EEIntake-Pages
```

Or manually trigger:
- Go to: https://github.com/rc979/EEIntake-Pages/actions
- Click "Sync from Main Repo" → "Run workflow" → "Run workflow"

**Note:** The GitHub Actions workflow copies from `exports/github-pages/` directly (not from any staging folder).

## File Structure

- `index.html` - Main landing page
- `outline/` - Project outline HTML export
- `phases/` - Phase artifacts (PDFs, XLSX, CSV)
- `galleries/` - Image galleries extracted from ZIP files
- `publish_manifest.json` - Metadata for link rewriting

## Features

- **XLSX Viewer:** XLSX files have built-in browser viewers (`.xlsx.html` pages)
- **CSV Viewer:** CSV files have built-in browser viewers (`.csv.html` pages)
- **Image Galleries:** ZIP photo sets are extracted into gallery pages
- **All links point to GitHub Pages URLs:** All file references use `https://rc979.github.io/EEIntake-Pages/`
- **Directory Indexes:** Auto-generated `index.html` pages for browsing artifacts

## Workflow Details

### How It Works

1. **Generation:** `publish_pages_site.py` generates the `docs/` folder with:
   - Phase artifacts copied from `phases/` directory
   - Image galleries extracted from ZIP files
   - HTML viewer pages for XLSX/CSV files
   - Directory index pages for browsing
   - Project outline HTML export

2. **URL Preparation:** `prepare_gh_pages.sh` updates URLs in-place:
   - Replaces any old Netlify URLs with GitHub Pages URLs
   - Updates all HTML files in the `docs/` folder

3. **Deployment:** Git subtree push:
   - Splits the `docs/` folder into its own commit history
   - Pushes directly to the `EEIntake-Pages` repository
   - No intermediate staging folder needed

### Why Push `docs/` Directly?

Previously, we used a `gh-pages-ready/` staging folder, but this was redundant:
- ❌ Required copying files (extra step)
- ❌ Created duplicate content
- ❌ Added complexity

Now we push `docs/` directly:
- ✅ Simpler workflow
- ✅ One less folder to manage
- ✅ URLs updated in-place
- ✅ Faster deployment

## Troubleshooting

### Site not updating
- Check GitHub Actions: https://github.com/rc979/EEIntake-Pages/actions
- Verify Pages is enabled: https://github.com/rc979/EEIntake-Pages/settings/pages
- Wait a few minutes for GitHub to rebuild

### Links broken
- Run `./scripts/publish/prepare_gh_pages.sh` to regenerate files with correct links
- Verify base URL in `scripts/publish/linkify_outline_public_urls.py` is correct

## Related Repositories

- **Main Repo (Private):** https://github.com/rc979/EEIntake
- **Pages Repo (Public):** https://github.com/rc979/EEIntake-Pages
