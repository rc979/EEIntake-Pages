<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="robots" content="noindex, nofollow">
  <title>EE Intake Artifacts</title>
  <script src="https://cdn.auth0.com/js/auth0/9.24.1/auth0.min.js"></script>
  <script>
    // Auth0 protection - redirect to login if not authenticated
    (function() {
      // Wait for Auth0 SDK to load
      if (typeof auth0 === 'undefined') {
        console.error('Auth0 SDK not loaded');
        return;
      }
      
      // Try US region format first (most common)
      // If this doesn't work, check your Auth0 Dashboard → Settings → General → Domain
      const AUTH0_DOMAIN = 'dev-etm8p8yhx6s75syc.us.auth0.com';
      const AUTH0_CLIENT_ID = 'T8rMJ51UJ6efeHrRauKN4x29jpvlRL85';
      const REDIRECT_URI = window.location.origin;
      
      // Use different variable name to avoid shadowing global auth0
      const webAuth = new auth0.WebAuth({
        domain: AUTH0_DOMAIN,
        clientID: AUTH0_CLIENT_ID,
        redirectUri: REDIRECT_URI,
        responseType: 'token id_token',
        scope: 'openid profile email'
      });

      // Handle Auth0 callback first (if returning from login)
      if (window.location.hash) {
        webAuth.parseHash((err, authResult) => {
          if (err) {
            console.error('Auth0 error:', err);
            return;
          }
          if (authResult && authResult.accessToken) {
            localStorage.setItem('access_token', authResult.accessToken);
            localStorage.setItem('id_token', authResult.idToken);
            localStorage.setItem('isAuthenticated', 'true');
            // Clear hash and reload
            window.location.hash = '';
            window.location.reload();
            return;
          }
        });
        return; // Don't check auth while processing callback
      }

      // Check if user is authenticated
      const isAuthenticated = localStorage.getItem('isAuthenticated') === 'true';
      const accessToken = localStorage.getItem('access_token');
      
      if (!isAuthenticated || !accessToken) {
        // Not authenticated, redirect to Auth0 login immediately
        console.log('Not authenticated, redirecting to Auth0...');
        webAuth.authorize();
        return;
      }
      
      // User is authenticated, continue loading the page
      console.log('User authenticated');
    })();
  </script>
  <style>
    body { font-family: -apple-system, BlinkMacSystemFont, Segoe UI, Roboto, Helvetica, Arial, sans-serif; margin: 24px; max-width: 900px; }
    a { color: #0b57d0; text-decoration: none; }
    a:hover { text-decoration: underline; }
    .box { border: 1px solid #ddd; border-radius: 12px; padding: 14px; margin: 12px 0; }
    code { background: #f6f6f6; padding: 1px 4px; border-radius: 4px; }
  </style>
</head>
<body>
  <h1>EE Intake – Published Artifacts</h1>
  <div class="box">
    <div><strong>Phase artifacts</strong>: <code>docs/phases/</code> (published)</div>
    <div><strong>Galleries</strong>: <code>docs/galleries/</code> (published)</div>
    <div><strong>Manifest</strong>: <code>docs/publish_manifest.json</code></div>
  </div>
  <div class="box">
    <div>Artifacts copied: <strong>57</strong></div>
    <div>Galleries generated: <strong>3</strong></div>
  </div>
  <ul>
    <li><a href="outline/index.html">Browse project outline (HTML)</a></li>
    <li><a href="galleries/index.html">Browse galleries</a></li>
    <li><a href="phases/index.html">Browse phases folder</a></li>
  </ul>
  <p>
    Note: This site is generated locally by <code>scripts/publish/publish_pages_site.py</code>.
    To update the project outline to point at these public URLs, run <code>scripts/publish/linkify_outline_public_urls.py</code>
    and then re-export the Word doc.
  </p>
</body>
</html>
